# ะะพัะพะดัะบะฐั ะณะตะพะธะฝัะพัะผะฐัะธะพะฝะฝะฐั ัะธััะตะผะฐ

ะะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ะดะปั ัะฐะฑะพัั ั ะณะตะพะฟัะพัััะฐะฝััะฒะตะฝะฝัะผะธ ะดะฐะฝะฝัะผะธ ะณะพัะพะดะฐ: ะพะฑัะตะบัั ะธะฝััะฐััััะบัััั, ัะพะฑััะธั ะธ ัะฐะนะพะฝั. ะะพัััะพะตะฝะพ ะฝะฐ FastAPI, PostgreSQL ั PostGIS ะธ Leaflet.

## ๐ ะะพะทะผะพะถะฝะพััะธ

- ๐ฅ **ะฃะฟัะฐะฒะปะตะฝะธะต ะพะฑัะตะบัะฐะผะธ ะธะฝััะฐััััะบัััั**: ะฑะพะปัะฝะธัั, ัะบะพะปั, ะบะฐัะต, ะฟะฐัะบะพะฒะบะธ, ะฐะฟัะตะบะธ
- ๐ **ะััะปะตะถะธะฒะฐะฝะธะต ัะพะฑััะธะน**: ะะขะ, ัะตะผะพะฝัั ะดะพัะพะณ, ะณะพัะพะดัะบะธะต ะผะตัะพะฟัะธััะธั
- ๐บ๏ธ **ะะฐะฑะพัะฐ ั ัะฐะนะพะฝะฐะผะธ**: ะณัะฐะฝะธัั, ะฝะฐัะตะปะตะฝะธะต, ััะฐัะธััะธะบะฐ
- ๐ **ะะตะพะฟัะพัััะฐะฝััะฒะตะฝะฝัะต ะทะฐะฟัะพัั**:
  - ะะพะธัะบ ะพะฑัะตะบัะพะฒ ะฒ ัะฐะดะธััะต
  - ะะพะธัะบ ะฑะปะธะถะฐะนัะตะณะพ ะพะฑัะตะบัะฐ
  - ะะฟัะตะดะตะปะตะฝะธะต ัะฐะนะพะฝะฐ ะฟะพ ะบะพะพัะดะธะฝะฐัะฐะผ
  - ะกัะฐัะธััะธะบะฐ ะฟะพ ัะฐะนะพะฝะฐะผ
- ๐จ **ะะฝัะตัะฐะบัะธะฒะฝะฐั ะบะฐััะฐ** ั ัะฐะทะปะธัะฝัะผะธ ัะปะพัะผะธ ะธ ัะธะปัััะฐะผะธ

## ๐๏ธ ะััะธัะตะบัััะฐ

```
geo_2025/
โโโ backend/             # FastAPI ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ app/
โ   โ   โโโ main.py      # ะขะพัะบะฐ ะฒัะพะดะฐ
โ   โ   โโโ database.py  # ะะพะดะบะปััะตะฝะธะต ะบ ะะ
โ   โ   โโโ models.py    # SQLAlchemy ะผะพะดะตะปะธ
โ   โ   โโโ schemas.py   # Pydantic ััะตะผั
โ   โ   โโโ routers/     # API ัะฝะดะฟะพะธะฝัั
โ   โ       โโโ objects.py
โ   โ       โโโ events.py
โ   โ       โโโ districts.py
โ   โโโ Dockerfile
โ   โโโ requirements.txt
โโโ frontend/            # ะะตะฑ-ะธะฝัะตััะตะนั
โ   โโโ index.html
โ   โโโ css/style.css
โ   โโโ js/
โ   โ   โโโ map.js      # ะะพะณะธะบะฐ ะบะฐััั
โ   โ   โโโ api.js      # API ะบะปะธะตะฝั
โ   โโโ Dockerfile
โ   โโโ nginx.conf
โโโ sql/                # SQL ัะบัะธะฟัั
โ   โโโ init.sql        # ะะฝะธัะธะฐะปะธะทะฐัะธั ะะ
โ   โโโ test_data.sql   # ะขะตััะพะฒัะต ะดะฐะฝะฝัะต
โ   โโโ clear_data.sql  # ะัะธััะบะฐ ะดะฐะฝะฝัั
โโโ docker-compose.yml
โโโ .env
```

## ะกัะฐัั

### ะขัะตะฑะพะฒะฐะฝะธั

- Docker
- Docker Compose

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone https://github.com/Burunduke/geo_2025
cd geo_2025
```

### 2. ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

ะคะฐะนะป `.env` ัะถะต ะฝะฐัััะพะตะฝ ั ะฑะฐะทะพะฒัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ:

```env
POSTGRES_USER=geo_user
POSTGRES_PASSWORD=geo_password
POSTGRES_DB=city_geo_db

BACKEND_HOST=backend
BACKEND_PORT=8000
```

### 3. ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั

```bash
# ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ
docker-compose up -d

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
docker-compose ps
```

ะัะธะปะพะถะตะฝะธะต ะฑัะดะตั ะดะพัััะฟะฝะพ ะฟะพ ะฐะดัะตัั: **http://localhost**

API ะดะพะบัะผะตะฝัะฐัะธั: **http://localhost:8000/docs**

### 4. ะััะฐะฝะพะฒะบะฐ ะฟัะธะปะพะถะตะฝะธั

```bash
# ะััะฐะฝะพะฒะบะฐ ัะตัะฒะธัะพะฒ
docker-compose down

# ะััะฐะฝะพะฒะบะฐ ั ัะดะฐะปะตะฝะธะตะผ ัะพะผะพะฒ (ะฟะพะปะฝะฐั ะพัะธััะบะฐ)
docker-compose down -v
```

## ะฃะฟัะฐะฒะปะตะฝะธะต ะดะฐะฝะฝัะผะธ

### ะะฐะณััะทะบะฐ ัะตััะพะฒัั ะดะฐะฝะฝัั

```bash
docker-compose exec -T db psql -U geo_user -d city_geo_db < sql/test_data.sql
```

ะขะตััะพะฒัะต ะดะฐะฝะฝัะต ะฒะบะปััะฐัั:
- 2 ัะฐะนะพะฝะฐ (ะัะธะผะพััะบะธะน ะธ ะฆะตะฝััะฐะปัะฝัะน)
- 13 ะพะฑัะตะบัะพะฒ ะธะฝััะฐััััะบัััั
- 7 ัะพะฑััะธะน

### ะัะธััะบะฐ ะฒัะตั ะดะฐะฝะฝัั

```bash
docker-compose exec -T db psql -U geo_user -d city_geo_db < sql/clear_data.sql
```

### ะัะฟะพะปะฝะตะฝะธะต ะฟัะพะธะทะฒะพะปัะฝัั SQL ะทะฐะฟัะพัะพะฒ

```bash
# ะะฝัะตัะฐะบัะธะฒะฝะฐั ะบะพะฝัะพะปั
docker-compose exec db psql -U geo_user -d city_geo_db

# ะัะฟะพะปะฝะตะฝะธะต ะทะฐะฟัะพัะฐ
docker-compose exec db psql -U geo_user -d city_geo_db -c "SELECT COUNT(*) FROM objects;"
```

## ะะฐะทัะฐะฑะพัะบะฐ

## API Endpoints

### ะะฑัะตะบัั (`/api/objects`)

- `GET /api/objects/`                       - ะะพะปััะธัั ะฒัะต ะพะฑัะตะบัั
- `GET /api/objects/?object_type=hospital`  - ะคะธะปััั ะฟะพ ัะธะฟั
- `POST /api/objects/nearby`                - ะะพะธัะบ ะฒ ัะฐะดะธััะต
- `GET /api/objects/nearest`                - ะะปะธะถะฐะนัะธะน ะพะฑัะตะบั
- `POST /api/objects/`                      - ะกะพะทะดะฐัั ะพะฑัะตะบั
- `GET /api/objects/types`                  - ะขะธะฟั ะพะฑัะตะบัะพะฒ

### ะกะพะฑััะธั (`/api/events`)

- `GET /api/events/`                        - ะะพะปััะธัั ะฒัะต ัะพะฑััะธั
- `GET /api/events/?event_type=accident`    - ะคะธะปััั ะฟะพ ัะธะฟั
- `GET /api/events/nearby`                  - ะกะพะฑััะธั ะฒ ัะฐะดะธััะต
- `POST /api/events/`                       - ะกะพะทะดะฐัั ัะพะฑััะธะต
- `GET /api/events/types`                   - ะขะธะฟั ัะพะฑััะธะน

### ะะฐะนะพะฝั (`/api/districts`)

- `GET /api/districts/`                     - ะะพะปััะธัั ะฒัะต ัะฐะนะพะฝั
- `GET /api/districts/find`                 - ะะฐะนัะธ ัะฐะนะพะฝ ะฟะพ ะบะพะพัะดะธะฝะฐัะฐะผ
- `GET /api/districts/{id}/objects`         - ะะฑัะตะบัั ะฒ ัะฐะนะพะฝะต
- `GET /api/districts/{id}/events`          - ะกะพะฑััะธั ะฒ ัะฐะนะพะฝะต
- `GET /api/districts/{id}/stats`           - ะกัะฐัะธััะธะบะฐ ัะฐะนะพะฝะฐ
- `GET /api/districts/{id}/buffer`          - ะััะตัะฝะฐั ะทะพะฝะฐ
- `GET /api/districts/intersect`            - ะะตัะตัะตะบะฐััะธะตัั ัะฐะนะพะฝั

## ะะฐะทะฐ ะดะฐะฝะฝัั

### ะกัััะบัััะฐ ัะฐะฑะปะธั

**objects**     - ะะฑัะตะบัั ะธะฝััะฐััััะบัััั
- `id`          - ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั
- `name`        - ะะฐะทะฒะฐะฝะธะต
- `type`        - ะขะธะฟ (hospital, school, cafe, parking, pharmacy)
- `address`     - ะะดัะตั
- `geom`        - ะะตะพะผะตััะธั (Point, SRID 4326)
- `created_at`  - ะะฐัะฐ ัะพะทะดะฐะฝะธั

**events**      - ะกะพะฑััะธั
- `id`          - ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั
- `title`       - ะะฐะทะฒะฐะฝะธะต
- `event_type`  - ะขะธะฟ (accident, repair, festival)
- `description` - ะะฟะธัะฐะฝะธะต
- `geom`        - ะะตะพะผะตััะธั (Point, SRID 4326)
- `start_time`  - ะัะตะผั ะฝะฐัะฐะปะฐ
- `end_time`    - ะัะตะผั ะพะบะพะฝัะฐะฝะธั
- `created_at`  - ะะฐัะฐ ัะพะทะดะฐะฝะธั

**districts**   - ะะฐะนะพะฝั
- `id`          - ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั
- `name`        - ะะฐะทะฒะฐะฝะธะต
- `population`  - ะะฐัะตะปะตะฝะธะต
- `geom`        - ะะตะพะผะตััะธั (Polygon, SRID 4326)
- `created_at`  - ะะฐัะฐ ัะพะทะดะฐะฝะธั

### ะะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต

```bash
# ะกะพะทะดะฐะฝะธะต ะฑัะบะฐะฟะฐ
docker-compose exec db pg_dump -U geo_user city_geo_db > backup.sql

# ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะธะท ะฑัะบะฐะฟะฐ
docker-compose exec -T db psql -U geo_user -d city_geo_db < backup.sql
```

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะธะฝัะตััะตะนัะฐ

1. **ะัะฑะพั ัะพัะบะธ ะฝะฐ ะบะฐััะต** - ะะปะธะบะฝะธัะต ะฝะฐ ะบะฐััั ะดะปั ัััะฐะฝะพะฒะบะธ ะผะฐัะบะตัะฐ
2. **ะะพะธัะบ ะฒ ัะฐะดะธััะต** - ะฃะบะฐะถะธัะต ัะฐะดะธัั ะธ ัะธะฟ ะพะฑัะตะบัะฐ, ะฝะฐะถะผะธัะต "ะัะบะฐัั"
3. **ะะพะธัะบ ะฑะปะธะถะฐะนัะตะณะพ** - ะัะฑะตัะธัะต ัะธะฟ ะพะฑัะตะบัะฐ ะธ ะฝะฐะถะผะธัะต "ะะฐะนัะธ"
4. **ะกะปะพะธ ะบะฐััั** - ะัะฟะพะปัะทัะนัะต ัะตะบะฑะพะบัั ะดะปั ะพัะพะฑัะฐะถะตะฝะธั/ัะบัััะธั ัะปะพะตะฒ
5. **ะะฝัะพัะผะฐัะธั ะพ ัะฐะนะพะฝะต** - ะะปะธะบะฝะธัะต ะฝะฐ ัะฐะนะพะฝ ะดะปั ะฟัะพัะผะพััะฐ ััะฐัะธััะธะบะธ

## ะกัะตะบ ัะตัะฝะพะปะพะณะธะน

### Backend
- **FastAPI** - ะะตะฑ-ััะตะนะผะฒะพัะบ
- **SQLAlchemy** - ORM ะดะปั ัะฐะฑะพัั ั ะะ
- **GeoAlchemy2** - ะะฐััะธัะตะฝะธะต ะดะปั ะณะตะพะฟัะพัััะฐะฝััะฒะตะฝะฝัั ะดะฐะฝะฝัั
- **Pydantic** - ะะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั

### Frontend
- **Leaflet** - ะะธะฑะปะธะพัะตะบะฐ ะดะปั ะธะฝัะตัะฐะบัะธะฒะฝัั ะบะฐัั
- **OpenStreetMap** - ะะฐััะพะณัะฐัะธัะตัะบะธะต ะดะฐะฝะฝัะต
- **JavaScript**

### Database
- **PostgreSQL** - ะะตะปััะธะพะฝะฝะฐั ะะ
- **PostGIS** - ะะฐััะธัะตะฝะธะต ะดะปั ะณะตะพะฟัะพัััะฐะฝััะฒะตะฝะฝัั ะดะฐะฝะฝัั

### Infrastructure
- **Docker** - ะะพะฝัะตะนะฝะตัะธะทะฐัะธั
- **Docker Compose** - ะัะบะตัััะฐัะธั ะบะพะฝัะตะนะฝะตัะพะฒ
- **Nginx** - ะะตะฑ-ัะตัะฒะตั ะดะปั frontend

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั API

### ะกะพะทะดะฐะฝะธะต ะพะฑัะตะบัะฐ

```bash
curl -X POST "http://localhost:8000/api/objects/" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "ะะพะฒะฐั ะฑะพะปัะฝะธัะฐ",
    "type": "hospital",
    "address": "ัะป. ะัะธะผะตัะฝะฐั, 1",
    "lat": 59.9343,
    "lon": 30.3351
  }'
```

### ะะพะธัะบ ะพะฑัะตะบัะพะฒ ะฒ ัะฐะดะธััะต

```bash
curl -X POST "http://localhost:8000/api/objects/nearby" \
  -H "Content-Type: application/json" \
  -d '{
    "lat": 59.9343,
    "lon": 30.3351,
    "radius": 1000,
    "object_type": "hospital"
  }'
```

### ะกะพะทะดะฐะฝะธะต ัะพะฑััะธั

```bash
curl -X POST "http://localhost:8000/api/events/" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "ะะตะผะพะฝั ะดะพัะพะณะธ",
    "event_type": "repair",
    "description": "ะะปะฐะฝะพะฒัะน ัะตะผะพะฝั",
    "lat": 59.9343,
    "lon": 30.3351,
    "start_time": "2024-12-25T09:00:00",
    "end_time": "2024-12-25T18:00:00"
  }'
```